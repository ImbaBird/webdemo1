webpackJsonp([17],{EktI:function(e,o){},PMmw:function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=t("Xxa5"),a=t.n(n),r=t("exGp"),i=t.n(r),s=t("mtWM"),c=t.n(s),l=t("gyMJ"),h=t("Fd2+"),u={name:"sanitationCheck",data:function(){return{showperson:!1,personcolumns:[],person_name_val:"",floor:"",roomnum:"",checkvalue:"",floor_room:"",punishvalue:"",floor_room_columns:[],punishcolumns:["处罚","优秀"],money:"",floor_room_show:!1,showpunishType:!1,uploadImages:[],files:{name:"",type:""},remark:"",checktypecolumns:[],showchecktype:!1,checktype_val:"",person_num:""}},created:function(){this.getfloor_rooms(),this.getchecktype()},methods:{Floor_onConfirm:function(e){"string"!=typeof values&&(this.floor=e[0],this.roomnum=e[1],e=e.toString()),this.floor_room=e.split(",").join("-"),this.floor_room_show=!1,this.get_room_users()},checktype_onConfirm:function(e){this.checktype_val=e,this.showchecktype=!1},person_onConfirm:function(e){this.person_name_val=e.name,this.person_num=e.person_num,this.showperson=!1},punish_onConfirm:function(e){this.punishvalue=e,this.showpunishType=!1},look_img:function(e,o){Object(h.b)({images:e,startPosition:o})},onSubmit:function(e){var o=this;if(this.$loading("提交中"),e.check_img=this.uploadImages,e.check_img.length<1)return Object(h.c)("请上传图片"),this.$loading.close(),!1;Object(l.e)(e).then(function(e){200==e.data.code?(o.$loading.close(),h.c.success(e.data.msg),setTimeout(function(){o.$router.push({path:"/checklist"})},3e3)):(o.$loading.close(),h.c.fail(e.data.msg))})},getchecktype:function(){var e=this;Object(l.f)().then(function(o){e.checktypecolumns=o.data.data})},get_room_users:function(){var e=this,o={floor_num:this.floor,room_num:this.roomnum};Object(l.A)(o).then(function(o){e.personcolumns=o.data.data})},getfloor_rooms:function(){var e=this;Object(l.B)({repair_type:"宿舍"}).then(function(o){console.log(o.data.data),e.floor_room_columns=o.data.data})},imgclose:function(e){this.uploadImages.splice(e,1)},onRead:function(e){var o=this;return i()(a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o.$loading("图片上传中..."),(n=o).files.name=e.file.name,n.files.type=e.file.type,n.imgPreview(e.file);case 5:case"end":return t.stop()}},t,o)}))()},imgPreview:function(e){var o=this;if(e&&window.FileReader&&/^image/.test(e.type)){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){var e=this.result,t=new Image;t.src=e,this.result.length<=512e3?(o.headerImage=this.result,o.postImg()):t.onload=function(){var e=o.compress(t,void 0);o.headerImage=e,o.postImg()}}}},compress:function(e,o){var t=document.createElement("canvas"),n=t.getContext("2d"),a=document.createElement("canvas"),r=a.getContext("2d"),i=e.width,s=e.height,c=void 0;(c=i*s/4e6)>1?(i/=c=Math.sqrt(c),s/=c):c=1,t.width=i,t.height=s,n.fillStyle="#fff",n.fillRect(0,0,t.width,t.height);var l=void 0;if((l=i*s/1e6)>1){var h=~~(i/(l=~~(Math.sqrt(l)+1))),u=~~(s/l);a.width=h,a.height=u;for(var m=0;m<l;m++)for(var p=0;p<l;p++)r.drawImage(e,m*h*c,p*u*c,h*c,u*c,0,0,h,u),n.drawImage(a,m*h,p*u,h,u)}else n.drawImage(e,0,0,i,s);if(""!=o&&1!=o)switch(o){case 6:this.rotateImg(e,"left",t);break;case 8:this.rotateImg(e,"right",t);break;case 3:this.rotateImg(e,"right",t),this.rotateImg(e,"right",t)}var d=t.toDataURL("image/jpeg",.6);return a.width=a.height=t.width=t.height=0,d},rotateImg:function(e,o,t){if(null!=e){var n=e.height,a=e.width,r=2;null==r&&(r=0),"right"==o?++r>3&&(r=0):--r<0&&(r=3);var i=90*r*Math.PI/180,s=t.getContext("2d");switch(r){case 0:t.width=a,t.height=n,s.drawImage(e,0,0);break;case 1:t.width=n,t.height=a,s.rotate(i),s.drawImage(e,0,-n);break;case 2:t.width=a,t.height=n,s.rotate(i),s.drawImage(e,-a,-n);break;case 3:t.width=n,t.height=a,s.rotate(i),s.drawImage(e,-a,0)}}},dataURLtoFile:function(e){for(var o=e.split(","),t=atob(o[1]),n=t.length,a=new Uint8Array(n);n--;)a[n]=t.charCodeAt(n);return new File([a],this.files.name,{type:this.files.type})},postImg:function(){var e=this;return i()(a.a.mark(function o(){var t,n;return a.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t=e.dataURLtoFile(e.headerImage),(n=new window.FormData).append("file",t);try{c()({method:"post",url:"http://47.104.193.180:18086/fastfds-uploader/v3",data:n}).then(function(o){var t=o.data.url;e.uploadImages.push(t),e.$loading.close()})}catch(e){console.log(e)}case 4:case"end":return o.stop()}},o,e)}))()}}},m={render:function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("van-form",{on:{submit:e.onSubmit}},[t("div",[t("van-nav-bar",{attrs:{title:"新增检查"}}),e._v(" "),t("van-field",{attrs:{label:"房间号",value:e.floor_room,readonly:"",rules:[{required:!0,message:"请选择房间号"}],name:"floor_room_selector",placeholder:"点击选择","is-link":"","arrow-direction":"down"},on:{click:function(o){e.floor_room_show=!0}}}),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.floor_room_show,callback:function(o){e.floor_room_show=o},expression:"floor_room_show"}},[t("van-picker",{attrs:{columns:e.floor_room_columns,"show-toolbar":""},on:{cancel:function(o){e.floor_room_show=!1},confirm:e.Floor_onConfirm}})],1),e._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",name:"person_name",value:e.person_name_val,label:"选择人员：",placeholder:"点击选择","is-link":"","arrow-direction":"down",rules:[{required:!0,message:"请选择人员"}]},on:{click:function(o){e.showperson=!0}}}),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showperson,callback:function(o){e.showperson=o},expression:"showperson"}},[t("van-picker",{attrs:{"show-toolbar":"","value-key":"name",columns:e.personcolumns},on:{confirm:e.person_onConfirm,cancel:function(o){e.showperson=!1}}})],1),e._v(" "),t("van-field",{staticStyle:{display:"none"},attrs:{name:"person_num",label:"人员："},model:{value:e.person_num,callback:function(o){e.person_num=o},expression:"person_num"}}),e._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",name:"check_type",value:e.checktype_val,label:"检查类型：",placeholder:"点击选择","is-link":"",rules:[{required:!0,message:"请填写检查类型"}],"arrow-direction":"down"},on:{click:function(o){e.showchecktype=!0}}}),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showchecktype,callback:function(o){e.showchecktype=o},expression:"showchecktype"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.checktypecolumns},on:{confirm:e.checktype_onConfirm,cancel:function(o){e.showchecktype=!1}}})],1),e._v(" "),t("van-field",{attrs:{readonly:"",clickable:"",name:"check_state",value:e.punishvalue,label:"检查结果：",placeholder:"点击选择","is-link":"",rules:[{required:!0,message:"请填写检查结果"}],"arrow-direction":"down"},on:{click:function(o){e.showpunishType=!0}}}),e._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:e.showpunishType,callback:function(o){e.showpunishType=o},expression:"showpunishType"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:e.punishcolumns},on:{confirm:e.punish_onConfirm,cancel:function(o){e.showpunishType=!1}}})],1),e._v(" "),t("van-field",{attrs:{name:"fpunish_money",rules:[{required:!0,message:"请填写金额"}],label:"金额：",placeholder:"请输入金额"},model:{value:e.money,callback:function(o){e.money=o},expression:"money"}}),e._v(" "),t("div",{staticClass:"upload-images"},[e._l(e.uploadImages,function(o,n){return t("div",{key:n,staticClass:"img-box"},[t("div",{staticClass:"icon-po"},[t("img",{staticClass:"image",attrs:{src:o},on:{click:function(o){return e.look_img(e.uploadImages,n)}}}),e._v(" "),t("div",{staticClass:"icon-close",on:{click:function(o){return e.imgclose(n)}}},[e._v("×")])])])}),e._v(" "),t("van-uploader",{attrs:{"after-read":e.onRead,accept:"image/gif, image/jpeg, image/png","max-size":6e6}})],2),e._v(" "),t("van-field",{attrs:{name:"remark",rows:"2",autosize:"",label:"备注",type:"textarea",maxlength:"50",placeholder:"请输入备注","show-word-limit":""},model:{value:e.remark,callback:function(o){e.remark=o},expression:"remark"}}),e._v(" "),t("div",{staticStyle:{margin:"16px"}},[t("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("提交")])],1)],1)])},staticRenderFns:[]};var p=t("VU/8")(u,m,!1,function(e){t("EktI")},null,null);o.default=p.exports}});
//# sourceMappingURL=17.3e3c4de7038191d4a256.js.map